<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GutSync - AI-Powered Crohn's Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'] },
          colors: {
            dark: {
              950: '#000000',
              900: '#0D0D0D',
              800: '#1A1A1A',
              700: '#242424',
              600: '#2D2D2D',
              500: '#404040'
            },
            teal: {
              400: '#2DD4BF',
              500: '#00D4AA',
              600: '#00B894'
            },
            accent: {
              purple: '#8B5CF6',
              blue: '#06B6D4',
              pink: '#EC4899'
            }
          }
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: #0D0D0D; }
    .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom, 20px); }
    
    /* Animations */
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-ring { 0% { transform: scale(0.95); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 0.4; } 100% { transform: scale(0.95); opacity: 0.8; } }
    @keyframes mic-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 170, 0.3); } 50% { box-shadow: 0 0 40px rgba(0, 212, 170, 0.6); } }
    @keyframes ring-spin { from { stroke-dashoffset: 283; } to { stroke-dashoffset: 0; } }
    @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    
    .slide-up { animation: slideUp 0.3s ease-out; }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-500 { animation-delay: 0.5s; }
    .voice-btn-ring { animation: pulse-ring 2s ease-in-out infinite; }
    .mic-recording { animation: mic-pulse 1s ease-in-out infinite; }
    .glow-teal { animation: glow 2s ease-in-out infinite; }
    
    /* Ring Progress */
    .ring-progress { transform: rotate(-90deg); transform-origin: 50% 50%; }
    .ring-bg { stroke: #2D2D2D; }
    .ring-fill { stroke-linecap: round; transition: stroke-dashoffset 1s ease-out; }
    
    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #00D4AA, #06B6D4, #8B5CF6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Glass card effect */
    .glass-card {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: #1A1A1A; }
    ::-webkit-scrollbar-thumb { background: #404040; border-radius: 2px; }
  </style>
</head>
<body class="bg-dark-900 min-h-screen text-white">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;
    
    // ============ DATA MODELS & STORAGE ============
    const STORAGE_KEYS = {
      USER: 'gutsync_user',
      LOGS: 'gutsync_logs',
      ONBOARDED: 'gutsync_onboarded',
      WELCOMED: 'gutsync_welcomed'
    };
    
    const loadData = (key, defaultValue) => {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
      } catch { return defaultValue; }
    };
    
    const saveData = (key, data) => {
      localStorage.setItem(key, JSON.stringify(data));
    };
    
    // ============ DEMO DATA GENERATOR ============
    const generateDemoProfile = () => {
      const twoYearsAgo = new Date();
      twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
      return {
        diagnosisDate: twoYearsAgo.toISOString().split('T')[0],
        medications: ['Humira (adalimumab)', 'Prednisone'],
        createdAt: new Date().toISOString()
      };
    };
    
    const generateDemoLogs = () => {
      const logs = [];
      const today = new Date();
      
      // Generate 30 days of realistic data
      for (let i = 29; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        
        let painLevel, bowelCount, bristolType, fatigue, extras, medsTaken;
        
        // Days 29-20: Normal baseline period
        if (i >= 20) {
          painLevel = Math.floor(Math.random() * 2) + 1; // 1-2
          bowelCount = Math.floor(Math.random() * 3) + 2; // 2-4
          bristolType = Math.floor(Math.random() * 2) + 4; // 4-5
          fatigue = Math.floor(Math.random() * 2) + 4; // 4-5 (good energy)
          extras = Math.random() > 0.85 ? ['fatigue'] : [];
          medsTaken = Math.random() > 0.1 
            ? ['Humira (adalimumab)', 'Prednisone'] 
            : ['Humira (adalimumab)']; // Occasional missed dose
        }
        // Days 19-16: Building up to flare
        else if (i >= 16) {
          painLevel = Math.floor(Math.random() * 2) + 3; // 3-4
          bowelCount = Math.floor(Math.random() * 2) + 4; // 4-5
          bristolType = Math.floor(Math.random() * 2) + 5; // 5-6
          fatigue = 3;
          extras = Math.random() > 0.6 ? ['joint_pain'] : [];
          medsTaken = ['Humira (adalimumab)', 'Prednisone'];
        }
        // Days 15-12: Mini-flare episode (8-10 days ago from "today")
        else if (i >= 8 && i <= 11) {
          painLevel = Math.floor(Math.random() * 3) + 5; // 5-7
          bowelCount = Math.floor(Math.random() * 3) + 6; // 6-8
          bristolType = Math.floor(Math.random() * 2) + 6; // 6-7
          fatigue = Math.floor(Math.random() * 2) + 1; // 1-2 (exhausted)
          extras = ['fatigue', 'cramping'];
          if (Math.random() > 0.5) extras.push('joint_pain');
          if (Math.random() > 0.7) extras.push('nausea');
          if (i === 9) extras.push('blood'); // Worst day
          medsTaken = ['Humira (adalimumab)', 'Prednisone'];
        }
        // Days 7-4: Recovery period
        else if (i >= 4 && i <= 7) {
          painLevel = Math.floor(Math.random() * 2) + 3; // 3-4
          bowelCount = Math.floor(Math.random() * 2) + 3; // 3-4
          bristolType = Math.floor(Math.random() * 2) + 4; // 4-5
          fatigue = 3;
          extras = Math.random() > 0.7 ? ['fatigue'] : [];
          medsTaken = Math.random() > 0.15 
            ? ['Humira (adalimumab)', 'Prednisone'] 
            : ['Prednisone']; // Some missed Humira during recovery
        }
        // Days 3-0: Recent slight uptick (making risk interesting ~25-40%)
        else {
          // Recent days show slight worsening trend
          const dayFactor = 3 - i; // 0, 1, 2, 3 for days 3, 2, 1, 0
          painLevel = Math.min(2 + dayFactor + Math.floor(Math.random() * 2), 5); // Trending up 2->5
          bowelCount = Math.min(3 + Math.floor(dayFactor * 0.7) + Math.floor(Math.random() * 2), 5); // 3->5
          bristolType = Math.min(4 + Math.floor(dayFactor * 0.5), 6); // 4->5 or 6
          fatigue = Math.max(4 - dayFactor, 2); // Trending down 4->2
          extras = dayFactor >= 2 ? ['fatigue'] : [];
          if (dayFactor >= 2 && Math.random() > 0.5) extras.push('joint_pain');
          medsTaken = ['Humira (adalimumab)', 'Prednisone'];
        }
        
        // Calculate HBI
        let hbi = 0;
        hbi += Math.min(4, Math.floor((5 - fatigue) * 1.33));
        hbi += Math.min(3, Math.floor(painLevel / 3.33));
        hbi += Math.max(0, bowelCount - 2);
        
        logs.push({
          date: date.toISOString().split('T')[0],
          timestamp: date.toISOString(),
          painLevel,
          bowelCount,
          bristolType,
          fatigue,
          medsTaken,
          extras,
          notes: '',
          hbi
        });
      }
      
      return logs;
    };
    
    const loadDemoData = (setUser, setLogs) => {
      const demoUser = generateDemoProfile();
      const demoLogs = generateDemoLogs();
      
      saveData(STORAGE_KEYS.USER, demoUser);
      saveData(STORAGE_KEYS.LOGS, demoLogs);
      saveData(STORAGE_KEYS.ONBOARDED, true);
      saveData(STORAGE_KEYS.WELCOMED, true);
      
      setUser(demoUser);
      setLogs(demoLogs);
      
      return { user: demoUser, logs: demoLogs };
    };
    
    // Bristol Stool Scale definitions
    const BRISTOL_SCALE = [
      { type: 1, name: 'Separate hard lumps', desc: 'Constipation', color: 'bg-red-500' },
      { type: 2, name: 'Lumpy sausage', desc: 'Mild constipation', color: 'bg-orange-500' },
      { type: 3, name: 'Cracked sausage', desc: 'Normal', color: 'bg-yellow-500' },
      { type: 4, name: 'Smooth snake', desc: 'Ideal', color: 'bg-teal-500' },
      { type: 5, name: 'Soft blobs', desc: 'Trending loose', color: 'bg-yellow-500' },
      { type: 6, name: 'Fluffy, ragged', desc: 'Diarrhea', color: 'bg-orange-500' },
      { type: 7, name: 'Entirely liquid', desc: 'Severe', color: 'bg-red-500' }
    ];
    
    const EXTRA_SYMPTOMS = [
      { id: 'joint_pain', label: 'Joint Pain', icon: 'ü¶¥' },
      { id: 'skin_issues', label: 'Skin Issues', icon: 'üî¥' },
      { id: 'eye_problems', label: 'Eye Problems', icon: 'üëÅÔ∏è' },
      { id: 'nausea', label: 'Nausea', icon: 'ü§¢' },
      { id: 'mouth_sores', label: 'Mouth Sores', icon: 'üëÑ' },
      { id: 'fever', label: 'Fever', icon: 'üå°Ô∏è' },
      { id: 'fatigue', label: 'Fatigue', icon: 'üò¥' },
      { id: 'bloating', label: 'Bloating', icon: 'üéà' },
      { id: 'cramping', label: 'Cramping', icon: 'üí¢' },
      { id: 'blood', label: 'Blood in stool', icon: 'ü©∏' }
    ];
    
    const DEFAULT_MEDICATIONS = [
      'Humira (adalimumab)',
      'Remicade (infliximab)',
      'Stelara (ustekinumab)',
      'Entyvio (vedolizumab)',
      'Prednisone',
      'Budesonide',
      'Azathioprine',
      'Methotrexate',
      'Mesalamine'
    ];
    
    // ============ AI INSIGHTS ENGINE ============
    const generateInsights = (logs, user) => {
      if (logs.length < 3) {
        return { 
          status: 'neutral', 
          message: 'Keep logging to unlock AI insights', 
          details: 'We need at least 3 days of data to detect patterns.',
          riskPercent: null,
          riskLevel: null
        };
      }
      
      const recent = logs.slice(-7);
      const avgPain = recent.reduce((sum, l) => sum + (l.painLevel || 0), 0) / recent.length;
      const avgBowel = recent.reduce((sum, l) => sum + (l.bowelCount || 0), 0) / recent.length;
      const looseStools = recent.filter(l => l.bristolType >= 6).length;
      const avgFatigue = recent.reduce((sum, l) => sum + (5 - (l.fatigue || 3)), 0) / recent.length;
      
      let riskScore = 0;
      if (avgPain > 5) riskScore += 25;
      else if (avgPain > 3) riskScore += 12;
      if (avgBowel > 6) riskScore += 20;
      else if (avgBowel > 4) riskScore += 10;
      if (looseStools >= 4) riskScore += 30;
      else if (looseStools >= 2) riskScore += 15;
      if (avgFatigue > 2) riskScore += 15;
      else if (avgFatigue > 1) riskScore += 8;
      
      if (recent.length >= 3) {
        const lastThree = recent.slice(-3);
        const painTrend = lastThree[2]?.painLevel - lastThree[0]?.painLevel;
        if (painTrend > 2) riskScore += 15;
        else if (painTrend > 0) riskScore += 5;
        
        const bowelTrend = lastThree[2]?.bowelCount - lastThree[0]?.bowelCount;
        if (bowelTrend > 2) riskScore += 10;
      }
      
      const riskPercent = Math.min(Math.max(riskScore, 5), 85);
      
      if (riskPercent >= 50) {
        return {
          status: 'warning',
          riskLevel: 'high',
          riskPercent,
          message: 'Elevated flare risk detected',
          details: `Your symptoms suggest ${riskPercent}% chance of a flare in the next 24-72 hours.`,
          recommendation: 'Contact your GI, prepare flare kit'
        };
      } else if (riskPercent >= 25) {
        return {
          status: 'caution',
          riskLevel: 'medium',
          riskPercent,
          message: 'Moderate symptom activity',
          details: `${riskPercent}% flare risk in next 24-72 hours. Monitor closely.`,
          recommendation: 'Monitor closely, stay hydrated'
        };
      } else {
        return {
          status: 'good',
          riskLevel: 'low',
          riskPercent,
          message: 'Looking stable',
          details: `Only ${riskPercent}% flare risk. Keep up the good work!`,
          recommendation: 'Continue tracking, maintain routine'
        };
      }
    };
    
    const calculateHBI = (log) => {
      let score = 0;
      score += Math.min(4, Math.floor((5 - (log.fatigue || 3)) * 1.33));
      score += Math.min(3, Math.floor((log.painLevel || 0) / 3.33));
      score += Math.max(0, (log.bowelCount || 0) - 2);
      return score;
    };
    
    const findLastFlare = (logs) => {
      const sortedLogs = [...logs].sort((a, b) => new Date(b.date) - new Date(a.date));
      for (const log of sortedLogs) {
        if ((log.painLevel >= 6 && log.bowelCount >= 5) || log.bristolType >= 6 && log.painLevel >= 5) {
          const flareDate = new Date(log.date);
          const today = new Date();
          const diffDays = Math.floor((today - flareDate) / (1000 * 60 * 60 * 24));
          return { date: log.date, daysAgo: diffDays };
        }
      }
      return null;
    };
    
    // ============ VOICE RECOGNITION ============
    const useVoiceRecognition = () => {
      const [isListening, setIsListening] = useState(false);
      const [transcript, setTranscript] = useState('');
      const [isSupported, setIsSupported] = useState(false);
      const recognitionRef = useRef(null);
      
      useEffect(() => {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
          setIsSupported(true);
          recognitionRef.current = new SpeechRecognition();
          recognitionRef.current.continuous = false;
          recognitionRef.current.interimResults = true;
          recognitionRef.current.lang = 'en-US';
          
          recognitionRef.current.onresult = (event) => {
            let finalTranscript = '';
            for (let i = event.resultIndex; i < event.results.length; i++) {
              if (event.results[i].isFinal) {
                finalTranscript += event.results[i][0].transcript;
              }
            }
            if (finalTranscript) setTranscript(finalTranscript);
          };
          
          recognitionRef.current.onend = () => setIsListening(false);
          recognitionRef.current.onerror = () => setIsListening(false);
        }
      }, []);
      
      const startListening = useCallback(() => {
        if (recognitionRef.current && !isListening) {
          setTranscript('');
          recognitionRef.current.start();
          setIsListening(true);
        }
      }, [isListening]);
      
      const stopListening = useCallback(() => {
        if (recognitionRef.current && isListening) {
          recognitionRef.current.stop();
          setIsListening(false);
        }
      }, [isListening]);
      
      return { isListening, transcript, isSupported, startListening, stopListening, setTranscript };
    };
    
    const parseVoiceInput = (transcript) => {
      const text = transcript.toLowerCase();
      const result = { painLevel: null, bowelCount: null, bristolType: null, extras: [], notes: transcript };
      
      const painMatch = text.match(/pain.{0,10}(\d+)|(\d+).{0,10}(out of|\/)\s*10|level.{0,5}(\d+)/);
      if (painMatch) {
        const num = parseInt(painMatch[1] || painMatch[2] || painMatch[4]);
        if (num >= 0 && num <= 10) result.painLevel = num;
      }
      if (text.includes('no pain') || text.includes('feeling good')) result.painLevel = result.painLevel || 1;
      if (text.includes('mild pain')) result.painLevel = result.painLevel || 3;
      if (text.includes('moderate pain')) result.painLevel = result.painLevel || 5;
      if (text.includes('severe pain') || text.includes('bad pain')) result.painLevel = result.painLevel || 7;
      
      const bmMatch = text.match(/(\d+)\s*(bowel|bm|bathroom|times|movements?)/);
      if (bmMatch) result.bowelCount = parseInt(bmMatch[1]);
      
      if (text.includes('liquid') || text.includes('watery')) result.bristolType = 7;
      else if (text.includes('loose') || text.includes('soft')) result.bristolType = 6;
      else if (text.includes('normal') || text.includes('formed')) result.bristolType = 4;
      else if (text.includes('hard') || text.includes('constipated')) result.bristolType = 2;
      
      if (text.includes('joint')) result.extras.push('joint_pain');
      if (text.includes('skin') || text.includes('rash')) result.extras.push('skin_issues');
      if (text.includes('nausea')) result.extras.push('nausea');
      if (text.includes('tired') || text.includes('fatigue')) result.extras.push('fatigue');
      if (text.includes('bloat')) result.extras.push('bloating');
      if (text.includes('cramp')) result.extras.push('cramping');
      if (text.includes('blood')) result.extras.push('blood');
      
      return result;
    };
    
    // ============ RING PROGRESS COMPONENT ============
    const RingProgress = ({ percent, size = 120, strokeWidth = 8, colorClass = 'stroke-teal-500', label, sublabel }) => {
      const radius = (size - strokeWidth) / 2;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference - (percent / 100) * circumference;
      
      return (
        <div className="relative inline-flex items-center justify-center">
          <svg width={size} height={size} className="ring-progress">
            <circle
              className="ring-bg"
              cx={size/2}
              cy={size/2}
              r={radius}
              strokeWidth={strokeWidth}
              fill="none"
            />
            <circle
              className={`ring-fill ${colorClass}`}
              cx={size/2}
              cy={size/2}
              r={radius}
              strokeWidth={strokeWidth}
              fill="none"
              strokeDasharray={circumference}
              strokeDashoffset={offset}
            />
          </svg>
          <div className="absolute inset-0 flex flex-col items-center justify-center">
            <span className="text-2xl font-bold text-white">{label}</span>
            {sublabel && <span className="text-xs text-gray-400">{sublabel}</span>}
          </div>
        </div>
      );
    };
    
    // ============ WELCOME SCREEN ============
    const WelcomeScreen = ({ onGetStarted }) => {
      return (
        <div className="min-h-screen bg-dark-900 flex flex-col">
          {/* Hero Section */}
          <div className="flex-1 flex flex-col items-center justify-center px-6 py-12">
            {/* Logo */}
            <div className="fade-in-up mb-6">
              <div className="relative">
                <svg width="80" height="80" viewBox="0 0 80 80" className="mx-auto">
                  {/* Gut wave icon */}
                  <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" stopColor="#00D4AA" />
                      <stop offset="50%" stopColor="#06B6D4" />
                      <stop offset="100%" stopColor="#8B5CF6" />
                    </linearGradient>
                  </defs>
                  <circle cx="40" cy="40" r="38" fill="none" stroke="url(#logoGradient)" strokeWidth="2" />
                  <path 
                    d="M20 40 Q30 25 40 40 Q50 55 60 40" 
                    fill="none" 
                    stroke="url(#logoGradient)" 
                    strokeWidth="3" 
                    strokeLinecap="round"
                  />
                  <circle cx="25" cy="40" r="3" fill="#00D4AA" />
                  <circle cx="55" cy="40" r="3" fill="#8B5CF6" />
                </svg>
              </div>
            </div>
            
            {/* Title */}
            <h1 className="fade-in-up delay-100 text-4xl font-bold gradient-text mb-2">GutSync</h1>
            <p className="fade-in-up delay-200 text-gray-400 text-lg mb-10">AI-powered Crohn's management</p>
            
            {/* Feature List */}
            <div className="fade-in-up delay-300 w-full max-w-sm space-y-4 mb-10">
              <div className="flex items-center gap-4 p-4 glass-card rounded-2xl">
                <div className="w-12 h-12 bg-gradient-to-br from-teal-500/20 to-teal-500/5 rounded-xl flex items-center justify-center">
                  <span className="text-2xl">üéôÔ∏è</span>
                </div>
                <div>
                  <div className="font-semibold text-white">Voice Tracking</div>
                  <div className="text-sm text-gray-400">Log symptoms with your voice</div>
                </div>
              </div>
              
              <div className="flex items-center gap-4 p-4 glass-card rounded-2xl">
                <div className="w-12 h-12 bg-gradient-to-br from-accent-purple/20 to-accent-purple/5 rounded-xl flex items-center justify-center">
                  <span className="text-2xl">üìä</span>
                </div>
                <div>
                  <div className="font-semibold text-white">Flare Prediction</div>
                  <div className="text-sm text-gray-400">Predict flares up to 72 hours early</div>
                </div>
              </div>
              
              <div className="flex items-center gap-4 p-4 glass-card rounded-2xl">
                <div className="w-12 h-12 bg-gradient-to-br from-accent-blue/20 to-accent-blue/5 rounded-xl flex items-center justify-center">
                  <span className="text-2xl">üë®‚Äç‚öïÔ∏è</span>
                </div>
                <div>
                  <div className="font-semibold text-white">Doctor Reports</div>
                  <div className="text-sm text-gray-400">Generate reports for your GI</div>
                </div>
              </div>
              
              <div className="flex items-center gap-4 p-4 glass-card rounded-2xl">
                <div className="w-12 h-12 bg-gradient-to-br from-accent-pink/20 to-accent-pink/5 rounded-xl flex items-center justify-center">
                  <span className="text-2xl">üîó</span>
                </div>
                <div>
                  <div className="font-semibold text-white">Wearable Sync</div>
                  <div className="text-sm text-gray-400">Connect Apple Health & WHOOP</div>
                </div>
              </div>
            </div>
            
            {/* Integrations */}
            <div className="fade-in-up delay-400 mb-8">
              <p className="text-xs text-gray-500 text-center mb-3">INTEGRATIONS</p>
              <div className="flex gap-3">
                <div className="px-4 py-2 bg-dark-800 rounded-full border border-dark-600 text-sm text-gray-300 flex items-center gap-2">
                  <span className="text-red-400">‚ô•</span> Apple Health
                </div>
                <div className="px-4 py-2 bg-dark-800 rounded-full border border-dark-600 text-sm text-gray-300">
                  WHOOP
                </div>
                <div className="px-4 py-2 bg-dark-800 rounded-full border border-dark-600 text-sm text-gray-300">
                  Oura
                </div>
              </div>
            </div>
            
            {/* Impact Stat */}
            <div className="fade-in-up delay-500 text-center mb-10">
              <div className="inline-block px-6 py-3 bg-gradient-to-r from-teal-500/10 to-accent-purple/10 rounded-2xl border border-teal-500/20">
                <span className="text-teal-400 font-semibold">40% fewer ER visits</span>
                <span className="text-gray-400"> reported by patients using symptom trackers</span>
              </div>
            </div>
          </div>
          
          {/* Bottom CTA */}
          <div className="px-6 pb-8 safe-area-bottom">
            <button
              onClick={onGetStarted}
              className="w-full py-4 bg-gradient-to-r from-teal-500 to-accent-blue rounded-2xl font-semibold text-lg text-white shadow-lg shadow-teal-500/25 hover:shadow-teal-500/40 transition-all active:scale-[0.98]"
            >
              Get Started
            </button>
            <p className="text-center text-xs text-gray-500 mt-4 flex items-center justify-center gap-2">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              Your data stays on your device
            </p>
          </div>
        </div>
      );
    };
    
    // ============ ONBOARDING FLOW ============
    const OnboardingFlow = ({ onComplete }) => {
      const twoYearsAgo = new Date();
      twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
      const defaultDate = twoYearsAgo.toISOString().split('T')[0];
      
      const [diagnosisDate, setDiagnosisDate] = useState(defaultDate);
      const [medications, setMedications] = useState(['Humira (adalimumab)', 'Prednisone']);
      const [customMed, setCustomMed] = useState('');
      
      const handleMedToggle = (med) => {
        setMedications(prev => 
          prev.includes(med) ? prev.filter(m => m !== med) : [...prev, med]
        );
      };
      
      const generateDemoLogs = () => {
        const logs = [];
        const today = new Date();
        
        for (let i = 14; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          
          const isFlareDay = i >= 7 && i <= 9;
          const isRecovery = i >= 4 && i <= 6;
          
          const painLevel = isFlareDay ? Math.floor(Math.random() * 3) + 6 : 
                           isRecovery ? Math.floor(Math.random() * 2) + 3 :
                           Math.floor(Math.random() * 3) + 1;
          
          const bowelCount = isFlareDay ? Math.floor(Math.random() * 3) + 5 :
                            isRecovery ? Math.floor(Math.random() * 2) + 3 :
                            Math.floor(Math.random() * 2) + 2;
          
          const bristolType = isFlareDay ? Math.floor(Math.random() * 2) + 6 :
                             isRecovery ? Math.floor(Math.random() * 2) + 4 :
                             Math.floor(Math.random() * 2) + 3;
          
          const fatigue = isFlareDay ? Math.floor(Math.random() * 2) + 1 :
                         isRecovery ? 3 :
                         Math.floor(Math.random() * 2) + 4;
          
          logs.push({
            date: date.toISOString().split('T')[0],
            timestamp: date.toISOString(),
            painLevel,
            bowelCount,
            bristolType,
            fatigue,
            medsTaken: ['Humira (adalimumab)', 'Prednisone'],
            extras: isFlareDay ? ['fatigue', 'cramping'] : [],
            notes: '',
            hbi: calculateHBI({ bowelCount, painLevel, fatigue })
          });
        }
        
        return logs;
      };
      
      const finishOnboarding = () => {
        const userData = { diagnosisDate, medications, createdAt: new Date().toISOString() };
        saveData(STORAGE_KEYS.USER, userData);
        saveData(STORAGE_KEYS.ONBOARDED, true);
        
        const demoLogs = generateDemoLogs();
        saveData(STORAGE_KEYS.LOGS, demoLogs);
        
        onComplete(userData, demoLogs);
      };
      
      return (
        <div className="min-h-screen bg-dark-900 p-6 fade-in">
          {/* Header */}
          <div className="text-center mb-8 pt-8">
            <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-teal-500 to-accent-purple rounded-2xl flex items-center justify-center">
              <span className="text-3xl">‚öïÔ∏è</span>
            </div>
            <h1 className="text-2xl font-bold text-white mb-2">Quick Setup</h1>
            <p className="text-gray-400">Let's personalize your experience</p>
          </div>
          
          {/* Setup Form */}
          <div className="bg-dark-800 rounded-2xl p-6 mb-6 border border-dark-700">
            {/* Diagnosis Date */}
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-300 mb-2">
                When were you diagnosed?
              </label>
              <input 
                type="date"
                value={diagnosisDate}
                onChange={(e) => setDiagnosisDate(e.target.value)}
                className="w-full p-4 bg-dark-700 border border-dark-600 rounded-xl text-white focus:border-teal-500 focus:outline-none transition"
              />
            </div>
            
            {/* Medications */}
            <div>
              <label className="block text-sm font-medium text-gray-300 mb-2">
                Current Medications
              </label>
              <div className="space-y-2 max-h-64 overflow-y-auto">
                {DEFAULT_MEDICATIONS.map(med => (
                  <button
                    key={med}
                    onClick={() => handleMedToggle(med)}
                    className={`w-full p-3 rounded-xl text-left text-sm transition flex items-center justify-between ${
                      medications.includes(med) 
                        ? 'bg-teal-500/20 border border-teal-500/50 text-teal-400' 
                        : 'bg-dark-700 border border-dark-600 text-gray-300 hover:border-dark-500'
                    }`}
                  >
                    <span>{med}</span>
                    {medications.includes(med) && <span className="text-teal-400 font-bold">‚úì</span>}
                  </button>
                ))}
              </div>
              
              <div className="flex gap-2 mt-3">
                <input 
                  type="text"
                  placeholder="Add other medication..."
                  value={customMed}
                  onChange={(e) => setCustomMed(e.target.value)}
                  className="flex-1 p-3 bg-dark-700 border border-dark-600 rounded-xl text-sm text-white placeholder-gray-500 focus:border-teal-500 focus:outline-none"
                />
                <button 
                  onClick={() => { 
                    if (customMed.trim()) { 
                      handleMedToggle(customMed.trim()); 
                      setCustomMed(''); 
                    }
                  }}
                  className="px-4 bg-dark-700 border border-dark-600 rounded-xl font-medium text-sm text-gray-300 hover:bg-dark-600 transition"
                >
                  Add
                </button>
              </div>
            </div>
          </div>
          
          {/* Start Button */}
          <button 
            onClick={finishOnboarding}
            className="w-full py-4 bg-gradient-to-r from-teal-500 to-accent-blue rounded-xl font-semibold text-lg text-white shadow-lg shadow-teal-500/25 hover:shadow-teal-500/40 transition active:scale-[0.98]"
          >
            Start Tracking
          </button>
          
          <p className="text-center text-sm text-gray-500 mt-4">
            Demo data will be added for a better first experience
          </p>
        </div>
      );
    };
    
    // ============ VOICE LOG MODAL ============
    const VoiceLogModal = ({ isOpen, onClose, onSave, user, existingLog }) => {
      const { isListening, transcript, isSupported, startListening, stopListening, setTranscript } = useVoiceRecognition();
      const [parsedData, setParsedData] = useState(null);
      const [showManualForm, setShowManualForm] = useState(false);
      const [manualData, setManualData] = useState({
        painLevel: existingLog?.painLevel || 3,
        bowelCount: existingLog?.bowelCount || 2,
        bristolType: existingLog?.bristolType || 4,
        fatigue: existingLog?.fatigue || 3,
        medsTaken: existingLog?.medsTaken || [],
        extras: existingLog?.extras || [],
        notes: existingLog?.notes || ''
      });
      
      useEffect(() => {
        if (transcript) setParsedData(parseVoiceInput(transcript));
      }, [transcript]);
      
      const handleVoiceToggle = () => {
        isListening ? stopListening() : startListening();
      };
      
      const handleSaveVoice = () => {
        const log = {
          date: new Date().toISOString().split('T')[0],
          timestamp: new Date().toISOString(),
          painLevel: parsedData?.painLevel || 3,
          bowelCount: parsedData?.bowelCount || 2,
          bristolType: parsedData?.bristolType || 4,
          fatigue: 3,
          medsTaken: user?.medications || [],
          extras: parsedData?.extras || [],
          notes: transcript,
          hbi: calculateHBI({ bowelCount: parsedData?.bowelCount || 2, painLevel: parsedData?.painLevel || 3, fatigue: 3 })
        };
        onSave(log);
        onClose();
      };
      
      const handleSaveManual = () => {
        const log = {
          date: new Date().toISOString().split('T')[0],
          timestamp: new Date().toISOString(),
          ...manualData,
          hbi: calculateHBI(manualData)
        };
        onSave(log);
        onClose();
      };
      
      const simulateTranscription = () => {
        const demoTranscripts = [
          "Pain level about 4, went to the bathroom 3 times today, stools were a bit loose, feeling some fatigue",
          "Feeling pretty good today, mild pain around 2, normal bowel movements twice",
          "Not great today, pain is about 6 out of 10, had 5 bowel movements, liquid stools, also feeling nauseous"
        ];
        setTranscript(demoTranscripts[Math.floor(Math.random() * demoTranscripts.length)]);
      };
      
      if (!isOpen) return null;
      
      return (
        <div className="fixed inset-0 bg-black/80 z-50 flex items-end justify-center slide-up">
          <div className="bg-dark-800 rounded-t-3xl w-full max-w-lg max-h-[90vh] overflow-y-auto border-t border-dark-600">
            {/* Header */}
            <div className="sticky top-0 bg-dark-800 border-b border-dark-700 px-6 py-4 flex items-center justify-between">
              <h2 className="font-semibold text-lg text-white">Log Symptoms</h2>
              <button onClick={onClose} className="text-gray-400 text-2xl hover:text-white transition">&times;</button>
            </div>
            
            <div className="p-6">
              {!showManualForm ? (
                <>
                  {/* Voice Recording */}
                  <div className="text-center mb-6">
                    <p className="text-gray-400 mb-6">
                      {isListening ? 'Listening... Speak your symptoms' : 'Tap and describe how you\'re feeling'}
                    </p>
                    
                    <button
                      onClick={handleVoiceToggle}
                      disabled={!isSupported}
                      className={`relative w-32 h-32 rounded-full mx-auto flex items-center justify-center transition-all ${
                        isListening 
                          ? 'bg-red-500 scale-110' 
                          : 'bg-gradient-to-br from-teal-500 to-accent-blue glow-teal'
                      } ${!isSupported ? 'opacity-50' : ''}`}
                    >
                      {isListening && (
                        <div className="absolute inset-0 rounded-full bg-red-400 voice-btn-ring" />
                      )}
                      <span className={`text-5xl ${isListening ? 'mic-recording' : ''}`}>üé§</span>
                    </button>
                    
                    {!isSupported && (
                      <p className="text-orange-400 text-sm mt-4">
                        Voice not supported. 
                        <button onClick={simulateTranscription} className="underline ml-1 text-teal-400">Try demo</button>
                      </p>
                    )}
                  </div>
                  
                  {transcript && (
                    <div className="bg-dark-700 rounded-xl p-4 mb-4">
                      <p className="text-sm text-gray-400 mb-1">You said:</p>
                      <p className="text-white">"{transcript}"</p>
                    </div>
                  )}
                  
                  {parsedData && transcript && (
                    <div className="bg-teal-500/10 border border-teal-500/30 rounded-xl p-4 mb-6">
                      <p className="text-sm text-teal-400 font-medium mb-3">Detected symptoms:</p>
                      <div className="space-y-2 text-sm text-gray-300">
                        {parsedData.painLevel !== null && (
                          <div className="flex justify-between"><span>Pain Level:</span><span className="font-medium text-white">{parsedData.painLevel}/10</span></div>
                        )}
                        {parsedData.bowelCount !== null && (
                          <div className="flex justify-between"><span>Bowel Movements:</span><span className="font-medium text-white">{parsedData.bowelCount}</span></div>
                        )}
                        {parsedData.bristolType !== null && (
                          <div className="flex justify-between"><span>Stool Type:</span><span className="font-medium text-white">Bristol {parsedData.bristolType}</span></div>
                        )}
                        {parsedData.extras.length > 0 && (
                          <div className="flex justify-between"><span>Other:</span><span className="font-medium text-white">{parsedData.extras.join(', ')}</span></div>
                        )}
                      </div>
                    </div>
                  )}
                  
                  <div className="space-y-3">
                    {transcript && (
                      <button
                        onClick={handleSaveVoice}
                        className="w-full py-4 bg-gradient-to-r from-teal-500 to-accent-blue rounded-xl font-semibold text-white transition active:scale-[0.98]"
                      >
                        Save Log ‚úì
                      </button>
                    )}
                    <button
                      onClick={() => setShowManualForm(true)}
                      className="w-full py-3 border border-dark-600 text-gray-400 rounded-xl font-medium hover:bg-dark-700 transition"
                    >
                      Enter Manually Instead
                    </button>
                  </div>
                </>
              ) : (
                <>
                  {/* Manual Form */}
                  <div className="space-y-6">
                    {/* Pain Level */}
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">
                        Pain Level: <span className="text-teal-400">{manualData.painLevel}/10</span>
                      </label>
                      <input
                        type="range"
                        min="0"
                        max="10"
                        value={manualData.painLevel}
                        onChange={(e) => setManualData(d => ({ ...d, painLevel: parseInt(e.target.value) }))}
                        className="w-full h-2 bg-dark-600 rounded-lg appearance-none cursor-pointer accent-teal-500"
                      />
                      <div className="flex justify-between text-xs text-gray-500 mt-1">
                        <span>None</span>
                        <span>Severe</span>
                      </div>
                    </div>
                    
                    {/* Bowel Count */}
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Bowel Movements Today</label>
                      <div className="flex items-center justify-center gap-4">
                        <button 
                          onClick={() => setManualData(d => ({ ...d, bowelCount: Math.max(0, d.bowelCount - 1) }))}
                          className="w-12 h-12 bg-dark-700 border border-dark-600 rounded-full text-xl font-bold text-gray-300 hover:bg-dark-600 transition"
                        >‚àí</button>
                        <span className="text-3xl font-bold text-white w-12 text-center">{manualData.bowelCount}</span>
                        <button 
                          onClick={() => setManualData(d => ({ ...d, bowelCount: d.bowelCount + 1 }))}
                          className="w-12 h-12 bg-teal-500/20 border border-teal-500/50 rounded-full text-xl font-bold text-teal-400 hover:bg-teal-500/30 transition"
                        >+</button>
                      </div>
                    </div>
                    
                    {/* Bristol Type */}
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Stool Consistency</label>
                      <div className="flex gap-1">
                        {BRISTOL_SCALE.map(item => (
                          <button
                            key={item.type}
                            onClick={() => setManualData(d => ({ ...d, bristolType: item.type }))}
                            className={`flex-1 p-2 rounded-lg text-center transition ${
                              manualData.bristolType === item.type 
                                ? `${item.color} text-white` 
                                : 'bg-dark-700 text-gray-400 hover:bg-dark-600'
                            }`}
                          >
                            <div className="font-bold">{item.type}</div>
                          </button>
                        ))}
                      </div>
                    </div>
                    
                    {/* Extra Symptoms */}
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Other Symptoms</label>
                      <div className="flex flex-wrap gap-2">
                        {EXTRA_SYMPTOMS.map(s => (
                          <button
                            key={s.id}
                            onClick={() => setManualData(d => ({
                              ...d,
                              extras: d.extras.includes(s.id) 
                                ? d.extras.filter(e => e !== s.id)
                                : [...d.extras, s.id]
                            }))}
                            className={`px-3 py-2 rounded-lg text-sm transition ${
                              manualData.extras.includes(s.id)
                                ? 'bg-orange-500/20 border border-orange-500/50 text-orange-400'
                                : 'bg-dark-700 border border-dark-600 text-gray-400 hover:bg-dark-600'
                            }`}
                          >
                            {s.icon} {s.label}
                          </button>
                        ))}
                      </div>
                    </div>
                    
                    {/* Notes */}
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Notes (optional)</label>
                      <textarea
                        value={manualData.notes}
                        onChange={(e) => setManualData(d => ({ ...d, notes: e.target.value }))}
                        placeholder="Food triggers, stress, etc..."
                        className="w-full p-3 bg-dark-700 border border-dark-600 rounded-xl h-20 resize-none text-white placeholder-gray-500 focus:border-teal-500 focus:outline-none"
                      />
                    </div>
                  </div>
                  
                  <div className="mt-6 space-y-3">
                    <button
                      onClick={handleSaveManual}
                      className="w-full py-4 bg-gradient-to-r from-teal-500 to-accent-blue rounded-xl font-semibold text-white transition active:scale-[0.98]"
                    >
                      Save Log ‚úì
                    </button>
                    <button
                      onClick={() => setShowManualForm(false)}
                      className="w-full py-3 text-gray-500 font-medium hover:text-gray-300 transition"
                    >
                      ‚Üê Back to Voice
                    </button>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    };
    
    // ============ DASHBOARD ============
    const Dashboard = ({ user, logs, onCheckin, onResetDemo }) => {
      const insights = useMemo(() => generateInsights(logs, user), [logs, user]);
      const lastFlare = useMemo(() => findLastFlare(logs), [logs]);
      const [showVoiceModal, setShowVoiceModal] = useState(false);
      const [showMenu, setShowMenu] = useState(false);
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      const todayLog = logs.find(l => l.date === new Date().toISOString().split('T')[0]);
      
      const handleSaveLog = (log) => {
        onCheckin(log);
        setShowVoiceModal(false);
      };
      
      // Calculate stats
      const recent = logs.slice(-7);
      const avgPain = recent.length ? (recent.reduce((s, l) => s + (l.painLevel || 0), 0) / recent.length).toFixed(1) : '‚Äî';
      const avgBM = recent.length ? (recent.reduce((s, l) => s + (l.bowelCount || 0), 0) / recent.length).toFixed(1) : '‚Äî';
      const streak = (() => {
        let count = 0;
        const today = new Date();
        for (let i = 0; i < 30; i++) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];
          if (logs.find(l => l.date === dateStr)) count++;
          else if (i > 0) break;
        }
        return count;
      })();
      
      // Risk color
      const riskColors = {
        low: { stroke: 'stroke-teal-500', bg: 'from-teal-500/20 to-teal-500/5', text: 'text-teal-400' },
        medium: { stroke: 'stroke-yellow-500', bg: 'from-yellow-500/20 to-yellow-500/5', text: 'text-yellow-400' },
        high: { stroke: 'stroke-red-500', bg: 'from-red-500/20 to-red-500/5', text: 'text-red-400' }
      };
      const riskStyle = riskColors[insights.riskLevel] || riskColors.low;
      
      // Chart
      useEffect(() => {
        if (chartRef.current && logs.length > 0) {
          if (chartInstance.current) chartInstance.current.destroy();
          
          const recentLogs = logs.slice(-14);
          const ctx = chartRef.current.getContext('2d');
          
          chartInstance.current = new Chart(ctx, {
            type: 'line',
            data: {
              labels: recentLogs.map(l => new Date(l.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
              datasets: [
                {
                  label: 'Pain',
                  data: recentLogs.map(l => l.painLevel || 0),
                  borderColor: '#EF4444',
                  backgroundColor: 'rgba(239, 68, 68, 0.1)',
                  tension: 0.4,
                  fill: true,
                  borderWidth: 2,
                  pointRadius: 0
                },
                {
                  label: 'BM Count',
                  data: recentLogs.map(l => l.bowelCount || 0),
                  borderColor: '#00D4AA',
                  backgroundColor: 'rgba(0, 212, 170, 0.1)',
                  tension: 0.4,
                  fill: true,
                  borderWidth: 2,
                  pointRadius: 0
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { 
                legend: { 
                  position: 'bottom', 
                  labels: { 
                    boxWidth: 12, 
                    padding: 15,
                    color: '#9CA3AF',
                    font: { size: 11 }
                  } 
                } 
              },
              scales: {
                y: { 
                  beginAtZero: true, 
                  max: 10, 
                  grid: { color: '#2D2D2D' },
                  ticks: { color: '#6B7280', font: { size: 10 } }
                },
                x: { 
                  grid: { display: false },
                  ticks: { color: '#6B7280', font: { size: 10 } }
                }
              }
            }
          });
        }
        return () => { if (chartInstance.current) chartInstance.current.destroy(); };
      }, [logs]);
      
      return (
        <div className="pb-24 bg-dark-900 min-h-screen">
          <VoiceLogModal
            isOpen={showVoiceModal}
            onClose={() => setShowVoiceModal(false)}
            onSave={handleSaveLog}
            user={user}
            existingLog={todayLog}
          />
          
          {/* Header */}
          <div className="px-6 pt-6 pb-4">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-bold gradient-text">GutSync</h1>
                <p className="text-gray-500 text-sm">{new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
              </div>
              <div className="relative">
                <button 
                  onClick={() => setShowMenu(!showMenu)}
                  className="w-10 h-10 bg-gradient-to-br from-teal-500 to-accent-purple rounded-xl flex items-center justify-center hover:scale-105 transition"
                >
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2">
                    <path d="M6 12 Q12 6 18 12 Q12 18 6 12" />
                  </svg>
                </button>
                
                {/* Dropdown Menu */}
                {showMenu && (
                  <div className="absolute right-0 top-12 w-48 bg-dark-800 border border-dark-600 rounded-xl shadow-xl z-50 overflow-hidden">
                    <button
                      onClick={() => {
                        onResetDemo();
                        setShowMenu(false);
                      }}
                      className="w-full px-4 py-3 text-left text-sm text-gray-300 hover:bg-dark-700 flex items-center gap-2 transition"
                    >
                      <span>üîÑ</span>
                      <span>Reset Demo Data</span>
                    </button>
                    <div className="border-t border-dark-700">
                      <div className="px-4 py-2 text-xs text-gray-500">
                        v4.0 ‚Ä¢ Demo Mode
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
          
          {/* Click outside to close menu */}
          {showMenu && (
            <div className="fixed inset-0 z-40" onClick={() => setShowMenu(false)} />
          )}
          
          {/* Main Flare Risk Ring */}
          <div className="px-6 mb-6">
            <div className="bg-dark-800 rounded-3xl p-6 border border-dark-700">
              <div className="flex items-center justify-between">
                {/* Ring */}
                <div className="flex-shrink-0">
                  <RingProgress
                    percent={insights.riskPercent || 0}
                    size={120}
                    strokeWidth={10}
                    colorClass={riskStyle.stroke}
                    label={insights.riskPercent !== null ? `${insights.riskPercent}%` : '‚Äî'}
                    sublabel="Flare Risk"
                  />
                </div>
                
                {/* Info */}
                <div className="flex-1 ml-6">
                  <div className={`text-sm font-medium ${riskStyle.text} mb-1`}>
                    {insights.riskLevel ? insights.riskLevel.charAt(0).toUpperCase() + insights.riskLevel.slice(1) + ' Risk' : 'Calculating...'}
                  </div>
                  <p className="text-gray-400 text-sm mb-3">{insights.details}</p>
                  
                  {/* Last Flare */}
                  <div className="flex items-center gap-2 text-xs text-gray-500">
                    <span>Last flare:</span>
                    <span className="text-gray-300 font-medium">
                      {lastFlare ? `${lastFlare.daysAgo} days ago` : 'None recorded'}
                    </span>
                  </div>
                </div>
              </div>
              
              {/* Recommendation */}
              {insights.recommendation && (
                <div className={`mt-4 p-3 rounded-xl bg-gradient-to-r ${riskStyle.bg} border border-dark-600`}>
                  <div className="flex items-center gap-2">
                    <span className="text-lg">{insights.riskLevel === 'high' ? 'üö®' : insights.riskLevel === 'medium' ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                    <span className="text-sm text-gray-300">{insights.recommendation}</span>
                  </div>
                </div>
              )}
            </div>
          </div>
          
          {/* Voice Log Button */}
          <div className="px-6 mb-6">
            <button
              onClick={() => setShowVoiceModal(true)}
              className={`w-full p-6 rounded-2xl flex items-center justify-between transition ${
                todayLog 
                  ? 'bg-dark-800 border border-dark-700' 
                  : 'bg-gradient-to-r from-teal-500/20 to-accent-purple/20 border border-teal-500/30 glow-teal'
              }`}
            >
              <div className="flex items-center gap-4">
                <div className={`w-14 h-14 rounded-full flex items-center justify-center ${
                  todayLog ? 'bg-dark-700' : 'bg-gradient-to-br from-teal-500 to-accent-blue'
                }`}>
                  <span className="text-2xl">üé§</span>
                </div>
                <div className="text-left">
                  <div className={`font-semibold ${todayLog ? 'text-gray-300' : 'text-white'}`}>
                    {todayLog ? 'Update Today\'s Log' : 'Log Symptoms'}
                  </div>
                  <div className="text-sm text-gray-500">
                    {todayLog ? 'Tap to edit your entry' : 'Tap to speak or type'}
                  </div>
                </div>
              </div>
              <svg className="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
          
          {/* Stats Row */}
          <div className="px-6 mb-6">
            <div className="grid grid-cols-3 gap-3">
              <div className="bg-dark-800 rounded-2xl p-4 text-center border border-dark-700">
                <div className="text-2xl font-bold text-teal-400">{streak}</div>
                <div className="text-xs text-gray-500 mt-1">Day Streak üî•</div>
              </div>
              <div className="bg-dark-800 rounded-2xl p-4 text-center border border-dark-700">
                <div className="text-2xl font-bold text-white">{avgPain}</div>
                <div className="text-xs text-gray-500 mt-1">Avg Pain (7d)</div>
              </div>
              <div className="bg-dark-800 rounded-2xl p-4 text-center border border-dark-700">
                <div className="text-2xl font-bold text-white">{avgBM}</div>
                <div className="text-xs text-gray-500 mt-1">Avg BM (7d)</div>
              </div>
            </div>
          </div>
          
          {/* Trend Chart */}
          <div className="px-6 mb-6">
            <h2 className="font-semibold text-white mb-3">14-Day Trends</h2>
            <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
              {logs.length > 0 ? (
                <div className="h-48">
                  <canvas ref={chartRef}></canvas>
                </div>
              ) : (
                <div className="h-32 flex items-center justify-center text-gray-500">
                  <div className="text-center">
                    <div className="text-3xl mb-2">üìä</div>
                    <p>Log symptoms to see trends</p>
                  </div>
                </div>
              )}
            </div>
          </div>
          
          {/* Recent Logs */}
          <div className="px-6">
            <h2 className="font-semibold text-white mb-3">Recent Logs</h2>
            <div className="space-y-2">
              {logs.slice(-5).reverse().map((log, i) => (
                <div key={i} className="bg-dark-800 rounded-xl p-4 border border-dark-700 flex items-center justify-between">
                  <div>
                    <div className="font-medium text-white">
                      {new Date(log.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                    </div>
                    <div className="text-sm text-gray-500">
                      Pain: {log.painLevel}/10 ‚Ä¢ BM: {log.bowelCount} ‚Ä¢ Bristol: {log.bristolType || '‚Äî'}
                    </div>
                  </div>
                  <div className={`w-3 h-3 rounded-full ${
                    log.painLevel <= 3 ? 'bg-teal-500' : log.painLevel <= 6 ? 'bg-yellow-500' : 'bg-red-500'
                  }`} />
                </div>
              ))}
              {logs.length === 0 && (
                <div className="text-center py-8 text-gray-500 bg-dark-800 rounded-xl border border-dark-700">
                  No logs yet. Start tracking!
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };
    
    // ============ INSIGHTS SCREEN ============
    const InsightsScreen = ({ logs, user, onBack }) => {
      const insights = generateInsights(logs, user);
      const recent = logs.slice(-7);
      
      const avgPain = recent.length ? (recent.reduce((s, l) => s + (l.painLevel || 0), 0) / recent.length).toFixed(1) : 0;
      const avgBowel = recent.length ? (recent.reduce((s, l) => s + (l.bowelCount || 0), 0) / recent.length).toFixed(1) : 0;
      const avgHBI = recent.length ? (recent.reduce((s, l) => s + (l.hbi || 0), 0) / recent.length).toFixed(1) : 0;
      const looseDays = recent.filter(l => l.bristolType >= 6).length;
      
      const extraCounts = {};
      recent.forEach(l => (l.extras || []).forEach(e => { extraCounts[e] = (extraCounts[e] || 0) + 1; }));
      const topExtras = Object.entries(extraCounts).sort((a, b) => b[1] - a[1]).slice(0, 3);
      
      const riskColors = {
        low: { ring: 'stroke-teal-500', text: 'text-teal-400', bg: 'bg-teal-500' },
        medium: { ring: 'stroke-yellow-500', text: 'text-yellow-400', bg: 'bg-yellow-500' },
        high: { ring: 'stroke-red-500', text: 'text-red-400', bg: 'bg-red-500' }
      };
      const riskStyle = riskColors[insights.riskLevel] || riskColors.low;
      
      return (
        <div className="min-h-screen bg-dark-900 pb-24">
          <div className="bg-dark-800 border-b border-dark-700 px-4 py-3 flex items-center">
            <button onClick={onBack} className="text-teal-400 font-medium mr-4">‚Üê Back</button>
            <h2 className="font-semibold text-white">AI Insights</h2>
          </div>
          
          <div className="p-4 space-y-4">
            {/* Flare Risk */}
            <div className="bg-dark-800 rounded-2xl p-6 border border-dark-700">
              <h3 className="font-semibold text-white mb-4">Flare Risk Prediction</h3>
              <div className="flex items-center gap-6">
                <RingProgress
                  percent={insights.riskPercent || 0}
                  size={100}
                  strokeWidth={8}
                  colorClass={riskStyle.ring}
                  label={insights.riskPercent !== null ? `${insights.riskPercent}%` : '‚Äî'}
                />
                <div className="flex-1">
                  <div className={`font-medium ${riskStyle.text}`}>
                    {insights.riskLevel ? insights.riskLevel.charAt(0).toUpperCase() + insights.riskLevel.slice(1) + ' Risk' : 'Calculating...'}
                  </div>
                  <p className="text-sm text-gray-400 mt-1">{insights.details}</p>
                  <p className="text-xs text-gray-500 mt-2">Prediction window: next 24-72 hours</p>
                </div>
              </div>
            </div>
            
            {/* Weekly Summary */}
            <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
              <h3 className="font-semibold text-white mb-3">7-Day Summary</h3>
              <div className="grid grid-cols-2 gap-3">
                <div className="text-center p-3 bg-dark-700 rounded-xl">
                  <div className="text-2xl font-bold text-white">{avgPain}</div>
                  <div className="text-sm text-gray-500">Avg Pain</div>
                </div>
                <div className="text-center p-3 bg-dark-700 rounded-xl">
                  <div className="text-2xl font-bold text-white">{avgBowel}</div>
                  <div className="text-sm text-gray-500">Avg BM/Day</div>
                </div>
                <div className="text-center p-3 bg-dark-700 rounded-xl">
                  <div className="text-2xl font-bold text-white">{looseDays}</div>
                  <div className="text-sm text-gray-500">Loose Stool Days</div>
                </div>
                <div className="text-center p-3 bg-dark-700 rounded-xl">
                  <div className="text-2xl font-bold text-white">{avgHBI}</div>
                  <div className="text-sm text-gray-500">Avg HBI Score</div>
                </div>
              </div>
            </div>
            
            {/* Pattern Detection */}
            <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
              <h3 className="font-semibold text-white mb-3">Detected Patterns</h3>
              {topExtras.length > 0 ? (
                <div className="space-y-2">
                  {topExtras.map(([id, count]) => {
                    const symptom = EXTRA_SYMPTOMS.find(s => s.id === id);
                    return symptom ? (
                      <div key={id} className="flex items-center justify-between p-3 bg-orange-500/10 rounded-xl border border-orange-500/30">
                        <span className="text-gray-300">{symptom.icon} {symptom.label}</span>
                        <span className="text-sm text-gray-500">{count} days</span>
                      </div>
                    ) : null;
                  })}
                </div>
              ) : (
                <p className="text-gray-500">Not enough data to detect patterns yet.</p>
              )}
            </div>
            
            {/* Integrations */}
            <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
              <h3 className="font-semibold text-white mb-3">Health Integrations</h3>
              <div className="space-y-3">
                {[
                  { icon: '‚ù§Ô∏è', name: 'Apple Health', desc: 'HRV, Sleep, Activity' },
                  { icon: 'üí™', name: 'WHOOP', desc: 'Recovery Score, Strain' },
                  { icon: 'üíç', name: 'Oura Ring', desc: 'Readiness, Sleep Quality' }
                ].map((item, i) => (
                  <div key={i} className="flex items-center justify-between p-3 border border-dark-600 rounded-xl hover:border-dark-500 transition">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{item.icon}</span>
                      <div>
                        <div className="font-medium text-gray-300">{item.name}</div>
                        <div className="text-sm text-gray-500">{item.desc}</div>
                      </div>
                    </div>
                    <button className="text-teal-400 font-medium text-sm">Connect</button>
                  </div>
                ))}
              </div>
              <div className="mt-4 p-3 bg-accent-purple/10 rounded-xl border border-accent-purple/30">
                <p className="text-sm text-gray-300">
                  <strong className="text-accent-purple">Coming Soon:</strong> Connect wearables to detect flares 24-72 hours earlier using HRV and sleep patterns.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // ============ DOCTOR REPORT ============
    const DoctorReport = ({ logs, user, onBack }) => {
      const [dateRange, setDateRange] = useState(30);
      const [generating, setGenerating] = useState(false);
      
      const filteredLogs = useMemo(() => {
        const cutoff = new Date();
        cutoff.setDate(cutoff.getDate() - dateRange);
        return logs.filter(l => new Date(l.date) >= cutoff);
      }, [logs, dateRange]);
      
      const stats = useMemo(() => {
        if (!filteredLogs.length) return null;
        return {
          avgPain: (filteredLogs.reduce((s, l) => s + (l.painLevel || 0), 0) / filteredLogs.length).toFixed(1),
          avgBowel: (filteredLogs.reduce((s, l) => s + (l.bowelCount || 0), 0) / filteredLogs.length).toFixed(1),
          avgHBI: (filteredLogs.reduce((s, l) => s + (l.hbi || 0), 0) / filteredLogs.length).toFixed(1),
          totalLogs: filteredLogs.length,
          looseDays: filteredLogs.filter(l => l.bristolType >= 6).length,
          highPainDays: filteredLogs.filter(l => l.painLevel >= 7).length,
          adherence: user?.medications?.length 
            ? Math.round((filteredLogs.reduce((s, l) => s + (l.medsTaken?.length || 0), 0) / (filteredLogs.length * user.medications.length)) * 100)
            : null
        };
      }, [filteredLogs, user]);
      
      const generatePDF = () => {
        setGenerating(true);
        
        const report = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    GUTSYNC PATIENT REPORT                     ‚ïë
‚ïë                  Crohn's Disease Symptom Summary              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

PATIENT INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Diagnosis Date: ${user?.diagnosisDate || 'Not specified'}
Report Period: Last ${dateRange} days
Generated: ${new Date().toLocaleDateString()}

SUMMARY STATISTICS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Logs: ${stats?.totalLogs || 0} entries
Average Pain Level: ${stats?.avgPain || 0}/10
Average Bowel Movements: ${stats?.avgBowel || 0}/day
Average Harvey-Bradshaw Index: ${stats?.avgHBI || 0}
Days with Loose Stools (Bristol 6-7): ${stats?.looseDays || 0}
Days with High Pain (‚â•7): ${stats?.highPainDays || 0}
${stats?.adherence !== null ? `Medication Adherence: ${stats.adherence}%` : ''}

MEDICATIONS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${(user?.medications || []).join('\n') || 'None recorded'}

HARVEY-BRADSHAW INDEX INTERPRETATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Score < 5: Remission
‚Ä¢ Score 5-7: Mild disease
‚Ä¢ Score 8-16: Moderate disease  
‚Ä¢ Score > 16: Severe disease
Patient Average: ${stats?.avgHBI || 0}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Generated by GutSync - AI-Powered Crohn's Tracker
        `.trim();
        
        setTimeout(() => {
          const blob = new Blob([report], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `GutSync_Report_${new Date().toISOString().split('T')[0]}.txt`;
          a.click();
          URL.revokeObjectURL(url);
          setGenerating(false);
        }, 1000);
      };
      
      return (
        <div className="min-h-screen bg-dark-900 pb-24">
          <div className="bg-dark-800 border-b border-dark-700 px-4 py-3 flex items-center">
            <button onClick={onBack} className="text-teal-400 font-medium mr-4">‚Üê Back</button>
            <h2 className="font-semibold text-white">Doctor Report</h2>
          </div>
          
          <div className="p-4 space-y-4">
            {/* Date Range */}
            <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
              <h3 className="font-semibold text-white mb-3">Report Period</h3>
              <div className="flex gap-2">
                {[7, 14, 30, 90].map(d => (
                  <button
                    key={d}
                    onClick={() => setDateRange(d)}
                    className={`flex-1 py-2 rounded-lg font-medium transition ${
                      dateRange === d 
                        ? 'bg-teal-500 text-white' 
                        : 'bg-dark-700 text-gray-400 hover:bg-dark-600'
                    }`}
                  >
                    {d}d
                  </button>
                ))}
              </div>
            </div>
            
            {/* Preview */}
            {stats ? (
              <div className="bg-dark-800 rounded-2xl p-4 border border-dark-700">
                <h3 className="font-semibold text-white mb-3">Report Preview</h3>
                <div className="space-y-3">
                  {[
                    ['Logs Recorded', stats.totalLogs],
                    ['Avg Pain Level', `${stats.avgPain}/10`],
                    ['Avg BM/Day', stats.avgBowel],
                    ['Avg HBI Score', <span className={stats.avgHBI < 5 ? 'text-teal-400' : stats.avgHBI < 8 ? 'text-yellow-400' : 'text-red-400'}>{stats.avgHBI}</span>],
                    ['Loose Stool Days', stats.looseDays],
                    ['High Pain Days', stats.highPainDays]
                  ].map(([label, value], i) => (
                    <div key={i} className="flex justify-between py-2 border-b border-dark-700 last:border-0">
                      <span className="text-gray-400">{label}</span>
                      <span className="font-medium text-white">{value}</span>
                    </div>
                  ))}
                </div>
              </div>
            ) : (
              <div className="bg-dark-800 rounded-2xl p-8 border border-dark-700 text-center text-gray-500">
                <div className="text-4xl mb-2">üìä</div>
                <p>No data in selected period</p>
              </div>
            )}
            
            {/* HBI Info */}
            <div className="bg-accent-blue/10 rounded-2xl p-4 border border-accent-blue/30">
              <h4 className="font-semibold text-white mb-2">Harvey-Bradshaw Index</h4>
              <p className="text-sm text-gray-400 mb-2">
                Used by gastroenterologists to assess Crohn's disease activity.
              </p>
              <div className="text-sm text-gray-500 space-y-1">
                <div>‚Ä¢ &lt;5: <span className="text-teal-400">Remission</span></div>
                <div>‚Ä¢ 5-7: <span className="text-yellow-400">Mild disease</span></div>
                <div>‚Ä¢ 8-16: <span className="text-orange-400">Moderate disease</span></div>
                <div>‚Ä¢ &gt;16: <span className="text-red-400">Severe disease</span></div>
              </div>
            </div>
            
            {/* Generate Button */}
            <button
              onClick={generatePDF}
              disabled={!stats || generating}
              className="w-full py-4 bg-gradient-to-r from-teal-500 to-accent-blue rounded-xl font-semibold text-white disabled:opacity-50 disabled:cursor-not-allowed transition active:scale-[0.98]"
            >
              {generating ? '‚è≥ Generating...' : 'üì• Download Report'}
            </button>
            
            <p className="text-sm text-gray-500 text-center">
              Share this report with your GI doctor
            </p>
          </div>
        </div>
      );
    };
    
    // ============ BOTTOM NAVIGATION ============
    const BottomNav = ({ active, onNavigate }) => (
      <div className="fixed bottom-0 left-0 right-0 bg-dark-800 border-t border-dark-700 safe-area-bottom">
        <div className="flex justify-around py-2">
          {[
            { id: 'dashboard', icon: 'üè†', label: 'Home' },
            { id: 'insights', icon: 'ü§ñ', label: 'Insights' },
            { id: 'report', icon: 'üìã', label: 'Report' }
          ].map(item => (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`flex flex-col items-center py-2 px-4 transition ${
                active === item.id ? 'text-teal-400' : 'text-gray-500 hover:text-gray-300'
              }`}
            >
              <span className="text-xl">{item.icon}</span>
              <span className="text-xs mt-1">{item.label}</span>
            </button>
          ))}
        </div>
      </div>
    );
    
    // ============ MAIN APP ============
    const App = () => {
      const [isWelcomed, setIsWelcomed] = useState(() => loadData(STORAGE_KEYS.WELCOMED, false));
      const [isOnboarded, setIsOnboarded] = useState(() => loadData(STORAGE_KEYS.ONBOARDED, false));
      const [user, setUser] = useState(() => loadData(STORAGE_KEYS.USER, null));
      const [logs, setLogs] = useState(() => loadData(STORAGE_KEYS.LOGS, []));
      const [screen, setScreen] = useState('dashboard');
      
      // When "Get Started" is clicked, skip onboarding and load demo data directly
      const handleWelcomeComplete = () => {
        const { user: demoUser, logs: demoLogs } = loadDemoData(setUser, setLogs);
        setIsWelcomed(true);
        setIsOnboarded(true);
      };
      
      // Reset to fresh demo data
      const handleResetDemo = () => {
        loadDemoData(setUser, setLogs);
        setScreen('dashboard');
      };
      
      const handleOnboardingComplete = (userData, demoLogs) => {
        setUser(userData);
        if (demoLogs) setLogs(demoLogs);
        setIsOnboarded(true);
      };
      
      const handleSaveLog = (log) => {
        const existingIndex = logs.findIndex(l => l.date === log.date);
        let newLogs;
        if (existingIndex >= 0) {
          newLogs = [...logs];
          newLogs[existingIndex] = log;
        } else {
          newLogs = [...logs, log];
        }
        newLogs.sort((a, b) => new Date(a.date) - new Date(b.date));
        setLogs(newLogs);
        saveData(STORAGE_KEYS.LOGS, newLogs);
      };
      
      // Show Welcome screen first
      if (!isWelcomed) {
        return <WelcomeScreen onGetStarted={handleWelcomeComplete} />;
      }
      
      // Skip onboarding for demo - go straight to dashboard
      // (keeping onboarding code for potential future use)
      if (!isOnboarded && !user) {
        // Auto-load demo data if somehow we got here without it
        handleResetDemo();
        return null;
      }
      
      // Main app
      return (
        <div className="min-h-screen bg-dark-900">
          {screen === 'dashboard' && (
            <Dashboard 
              user={user} 
              logs={logs} 
              onCheckin={handleSaveLog}
              onResetDemo={handleResetDemo}
            />
          )}
          
          {screen === 'insights' && (
            <InsightsScreen 
              logs={logs} 
              user={user} 
              onBack={() => setScreen('dashboard')}
            />
          )}
          
          {screen === 'report' && (
            <DoctorReport 
              logs={logs} 
              user={user} 
              onBack={() => setScreen('dashboard')}
            />
          )}
          
          <BottomNav active={screen} onNavigate={setScreen} />
        </div>
      );
    };
    
    // Render
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
